<section id="pageWfEdit">
	<div ng-init="">
		<div class="container">
			<section id="preview">
				<div id="preview-content">
					<div class="content-container">
						<!-- taoster alert -->
						<toaster-container  toaster-options="{
																								'position-class': 'toast-top-full-width',
																								'extendedTimeout':500,
																								'timeOut':500,
																								}">
						</toaster-container>
						<uib-tabset justified="true">
							<uib-tab active="vm.tab.editTab.active" heading="{{'EDIT_TAB' | translate}}">
								<div class="row">
									<!-- STEP INDICATOR -->
									<div class="row stepwizardTopmargin">
										<div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2">
											<div class="stepwizard">
												<div class="row stepwizard-row">
													<div class="stepwizard-step col-md-3">
														<button type="button" class="btn btn-circle" ng-class="{'btn-primary': vm.configuration.stepIndicators[0], 'btn-default': !vm.configuration.stepIndicators[0]}" >0</button>
														<p>{{'WIZARD_LINES' | translate}}</p>
													</div>
													<div class="stepwizard-step col-md-3">
														<button type="button" class="btn btn-circle" ng-class="{'btn-primary': vm.configuration.stepIndicators[1], 'btn-default': !vm.configuration.stepIndicators[1], 'disabled': (vm.configuration.configStepCounter < 1)}"  >1</button>
														<p>{{'WIZARD_LAYOUT' | translate}}</p>
													</div>
													<div class="stepwizard-step col-md-3">
														<button type="button" class="btn btn-default btn-circle" ng-class="{'btn-primary': vm.configuration.stepIndicators[2], 'btn-default': !vm.configuration.stepIndicators[2], 'disabled': (vm.configuration.configStepCounter < 2)}" >2</button>
														<p>{{'WIZARD_CONTROLS' | translate}}</p>
													</div>
													<div class="stepwizard-step col-md-3">
														<button type="button" class="btn btn-default btn-circle" ng-class="{'btn-primary': vm.configuration.stepIndicators[3], 'btn-default': !vm.configuration.stepIndicators[3], 'disabled': (vm.configuration.configStepCounter < 3)}" >3</button>
														<p>{{'WIZARD_SAVE' | translate}}</p>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<ul class="pager">
										<li ng-class="{'disabled':vm.stepIndicators[0]}">
											<button class="btn btn-primary customPagerButton" ng-click="vm.previousConfigStep()" >
												<i class="fa fa-arrow-left fa-2x pull-left"></i>
												<span class="pull-right">{{'PAGER_PREVIOUS' | translate}}</span>
											</button>
										</li>
										<li ng-class="{'disabled':vm.stepIndicators[3]}">
											<button class="btn btn-primary customPagerButton" ng-click="vm.nextConfigStep()">
												<span class="pull-left">{{'PAGER_NEXT' | translate}}</span>
												<i class="fa fa-arrow-right fa-2x pull-right"></i>
											</button>
										</li>
									</ul>
									<div class="animate-switch-container" ng-switch on="vm.configuration.listConfigStep[vm.configuration.configStepCounter]">
										<div class="animate-switch" ng-switch-when="init">
											<div class="col-md-4" >
												<div id="commandPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-keyboard-o"></i>&nbsp;{{'COMMAND_PANEL' | translate}}</h3>
														</div>
														<div class="panel-body">
															<div class="row">
																<div class="col-md-12">
																	<span class="addNewLine">{{'ADD_NEW_LINE' | translate}} :</span>&nbsp;
																	<button class="btn btn-primary" ng-click="vm.addNewline()"><i class="fa fa-plus fa-1x"></i></button>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-md-8">
												<div id="visualPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-eye"></i>&nbsp;{{'VISUAL_PANEL' | translate}}</h3>
														</div>
														<div class="panel-body">
															<!-- lines -->
															<ul class="list-group">
																<li class="list-group-item" ng-repeat="line in vm.configuration.lines track by $index">
																	<!-- columns -->
																	<div class="row linesList">
																		<div class="col-md-12 lineCommandButtons" ng-show="vm.configuration.lines.length > 1">
																			<button
																				class="btn btn-warning"
																				ng-hide="$index==0 || $index==1"
																				ng-click="vm.upThisLine($index)">
																				<i class="fa fa-arrow-up"></i>
																			</button>
																			<button
																				class="btn btn-warning"
																				ng-hide="$index==(vm.configuration.lines.length-1) || $index==0"
																				ng-click="vm.downThisLine($index)">
																				<i class="fa fa-arrow-down"></i>
																			</button>
																			<button
																				class="btn btn-danger pull-right"
																				ng-hide="$index==0"
																				ng-click="vm.removeThisLine($index)">
																				<i class="fa fa-trash-o"></i>
																			</button>
																		</div>
																		<div class="col-md-12">
																			<div ng-repeat="column in line.columns">
																				<div class="col-md-{{12 / line.columns.length}} well">
																					<button class="btn btn-lg btn-block  btn-default disabled">
																						<div class="title">
																							{{column.control.templateOptions.label && column.control.templateOptions.label !== '' ? column.control.templateOptions.label : 'column ' + ($index + 1)}}
																							<div class="type">
																								{{column.control.type !== 'none'  ? column.control.type + ' ' + column.control.subtype || '' : 'column ' + ($index + 1)}}
																							</div>
																						</div>
																					</button>
																				</div>
																			</div>
																		</div>
																	</div>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="animate-switch" ng-switch-when="first">
											<div class="col-md-4">
												<div id="commandPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-keyboard-o"></i>&nbsp;{{'COMMAND_PANEL' | translate}}</h3>
														</div>
														<div class="panel-body">
															<div class="row">
																<div class="col-md-12">
																	<h4 class="numberOfcolumsText text-center"><i>- {{'SELECTED_LINE' | translate}} -</i></h4>
																	<h4 class="numberOfcolumsText text-center">{{'NUMBER_OF_COLUMN' | translate}} :</h4>
																</div>
															</div>
															<div class="row">
																<div class="col-xs-2 col-xs-offset-3 col-sm-2 col-sm-offset-3 col-md-2 col-md-offset-3">
																	<button class="btn btn-primary pull-right btnMinusColumns" ng-click="vm.decreaseNumberOfColumns(vm.configuration.activeLine -1, vm.configuration.lines[vm.configuration.activeLine - 1].columns.length - 1)"><i class="fa fa-minus fa-1x"></i></button>
																</div>
																<div class="col-xs-2 col-sm-2 col-md-2 text-center">
																	<span class="numberOfColumnsLabel ">{{vm.configuration.lines[vm.configuration.activeLine -1].columns.length}}</span>
																</div>
																<div class="col-xs-2 col-sm-2 col-md-2">
																	<button class="btn btn-primary pull-left btnAddColumns" ng-click="vm.increaseNumberOfColumns()"><i class="fa fa-plus fa-1x"></i></button>
															</div>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-md-8">
												<div id="visualPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-eye"></i>&nbsp;{{'VISUAL_PANEL' | translate}}</h3>
														</div>
														<div class="panel-body">
															<!-- lines / columns -->
															<ul class="list-group">
																<li class="list-group-item" ng-repeat="line in vm.configuration.lines track by $index">
																	<!-- columns -->
																	<div class="row linesList">
																		<div class="col-md-12 lineCommandButtons" ng-show="vm.configuration.lines.length > 1">
																			<button class="btn" ng-class="{'btn-warning':($index + 1) !== vm.configuration.activeLine, 'btn-success': ($index + 1) === vm.configuration.activeLine}" ng-click="vm.setActiveLineNumber($index + 1)">
																				<i class="fa"  ng-class="{'fa-square-o': ($index + 1) !== vm.configuration.activeLine, 'fa-check-square-o': ($index + 1) === vm.configuration.activeLine}"></i>
																			</button>
																		</div>
																		<div class="col-md-12">
																			<div ng-repeat="column in line.columns">
																				<div class="col-md-{{12 / line.columns.length}} well">
																					<!--button class="btn btn-warning btn-xs" ng-hide="$index==0 || $index==(line.columns.length-1)" ng-click="vm.upThisLine($index)"><i class="fa fa-arrows-h"></i></button-->
																					<button class="btn btn-lg btn-block btn-default disabled">
																						<div class="title">
																							{{column.control.templateOptions.label && column.control.templateOptions.label !== '' ? column.control.templateOptions.label : 'column ' + ($index + 1)}}
																							<div class="type">
																								{{column.control.type !== 'none'  ? column.control.type + ' ' + column.control.subtype || '' : 'column ' + ($index + 1)}}
																							</div>
																						</div>
																					</button>
																				</div>
																			</div>
																		</div>
																	</div>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="animate-switch" ng-switch-when="second">
											<div class="col-md-4">
												<div id="commandPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-keyboard-o"></i>&nbsp;{{'COMMAND_PANEL' | translate}}</h3>
														</div>
														<div class="panel-body">
															<div class="row">
																<div class="col-md-12">
																	<h4 class="numberOfcolumsText text-center">- {{'APPLY_CTRL2COL' | translate}} -</h4>
																</div>
															</div>
															<div class="row">
																<div class="col-lg-12">
																	<hr/>
																	<blockquote>
																		<p class="numberOfcolumsText"><i class="fa fa-minus"></i>&nbsp; {{'CLIC_TAP_2_OPEN' | translate}}.</p>
																		<p class="numberOfcolumsText"><i class="fa fa-minus"></i>&nbsp; {{'SELECT_2_APPLY_COL' | translate}}.</p>
																	</blockquote>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-md-8">
												<div id="visualPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-eye"></i>&nbsp;{{'VISUAL_PANEL' | translate}}</h3>
														</div>
														<div class="panel-body">
															<!-- lines / columns -->
															<ul class="list-group">
																<li class="list-group-item" ng-repeat="line in vm.configuration.lines track by $index">
																	<!-- columns -->
																	<div class="row linesList">
																		<div class="col-md-12 lineCommandButtons" ng-show="vm.configuration.lines.length > 1">
																			<button class="btn" ng-class="{'btn-warning':($index + 1) !== vm.configuration.activeLine, 'btn-success': ($index + 1) === vm.configuration.activeLine}" ng-click="vm.setActiveLineNumber($index + 1)">
																				<i class="fa"  ng-class="{'fa-square-o': ($index + 1) !== vm.configuration.activeLine, 'fa-check-square-o': ($index + 1) === vm.configuration.activeLine}"></i>
																			</button>
																		</div>
																		<div class="col-md-12">
																			<div ng-repeat="column in line.columns">
																				<div class="col-md-{{12 / line.columns.length}} well">
																					<button class="btn btn-lg btn-block" ng-class="{'btn-primary': !column.control.edited, 'btn-success': column.control.edited}" ng-click="vm.showModalAddCtrlToColumn('', $parent.$index, $index)">
																						<div class="title">
																							{{column.control.templateOptions.label && column.control.templateOptions.label !== '' ? column.control.templateOptions.label : 'column ' + ($index + 1)}}
																							<div class="type">
																								{{column.control.type !== 'none'  ? column.control.type + ' ' + column.control.subtype || '' : 'column ' + ($index + 1)}}
																							</div>
																						</div>
																					</button>
																				</div>
																			</div>
																		</div>
																	</div>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="animate-switch" ng-switch-when="third">
											<div class="col-md-4">
												<div id="commandPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-keyboard-o"></i>&nbsp;{{'COMMAND_PANEL' | translate}}</h3>
														</div>
														<div class="panel-body">
															<div class="row">
																<div class="col-xs-12">
																	<div class="form-group">
																		<label for="inputSubmitButtontext" class=" greyText control-label">{{'CUSTOM_SUBMIT_BTN' | translate}} :</label>
																		<div class="">
																			<input type="text" class="form-control" id="inputSubmitButtontext" placeholder="" ng-model="vm.configuration.submitButtonText">
																		</div>
																	</div>
																</div>
															</div>
															<hr/>
															<div class="row">
																<div class="col-xs-12">
																	<div class="form-group">
																		<label for="inputCancelButtontext" class=" greyText control-label">{{'CUSTOM_CANCEL_BTN' | translate}} :</label>
																		<div class="">
																			<input type="text" class="form-control" id="inputCancelButtontext" placeholder="" ng-model="vm.configuration.cancelButtonText">
																		</div>
																	</div>
																</div>
															</div>
															<hr/>
															<div class="row">
																<div class="col-xs-12">
																	<div class="form-group">
																		<label for="inputNameFormtext" class=" greyText control-label">{{'NAME_THIS_FORM' | translate}} :</label>
																		<div class="">
																			<input type="text" class="form-control" id="inputNameFormtext" placeholder="" ng-model="vm.configuration.formName">
																		</div>
																	</div>
																</div>
															</div>
															<hr/>
															<div class="row">
																<div class="col-xs-12">
																	<div class="form-group">
																		<label for="parentForm" class=" greyText control-label">{{'PARENT_FORM' | translate}} :</label>
																		<div class="">
										                  <ol
										                    class="nya-bs-select col-xs-12"
										                    ng-model="vm.configuration.parentForm"
										                    ng-init="vm.populateSourceForms();"
										                    id="parentForm"
										                    title="Nothing selected">
										                    <li nya-bs-option="form in vm.parentForms">
										                      <a>
										                        <span>
										                          {{ form.name }}
										                        </span>
										                        <span class="glyphicon glyphicon-ok check-mark"></span>
										                      </a>
										                    </li>
										                  </ol>
										                </div>
																	</div>
																</div>
															</div>
															<hr/>
															<div class="row">
																<div class="col-xs-12">
																	<div class="form-group" ng-class="{'has-error': vm.configuration.idFormat.length < 1 || !vm.configuration.idFormatValidation}">
																		<label for="idFormat" class=" greyText control-label">{{'FORM_ID_FORMAT' | translate}} :</label>
																		<div class="">
										                  <selectize
										                    ng-init="vm.populateFields();"
										                    config="vm.optionsSourceDbFormatConfig"
										                    options="vm.fields"
										                    ng-model="vm.configuration.idFormat">
										                  </selectize>
										                  <div class="validation">
										                  	<div ng-if="vm.configuration.idFormat.length < 1">{{'FIELD' | translate}}{{'VALIDATION_REQUIRED' | translate}}</div>
										                  	<div ng-if="!vm.configuration.idFormatValidation">{{'OPTIONAL_VALIDATION_FALSE' | translate}}</div>
										                  </div>
										                </div>
																	</div>
																</div>
															</div>
															<button class="btn btn-primary btn-block btn-lg" ng-click="vm.saveThisForm()" ng-disabled="!vm.configuration.idFormatValidation || vm.configuration.idFormat.length < 1">{{'SAVE_THIS_FORM' | translate}}</button>
														</div>
													</div>
												</div>
											</div>
											<div class="col-md-8">
												<div id="visualPanel">
													<div  class="panel panel-default">
														<div class="panel-heading">
															<h3 class="panel-title"><i class="fa fa-thumbs-o-up"></i>&nbsp;{{'FINAL_STEP' | translate}}</h3>
														</div>
														<div class="panel-body">
															<form ng-submit="vm.onSubmit()">
																<formly-form id="saveFormlyFom" model="vm.dataModel" fields="vm.wfFormFields">
																	<span class="pull-right">
																	<button class="btn btn-primary" type="submit">{{vm.configuration.submitButtonText}}</button>
																	<button class="btn btn-primary" type="cancel">{{vm.configuration.cancelButtonText}}</button>
																	</span>
																</formly-form>
															</form>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</uib-tab>
							<uib-tab active="vm.tab.previewTab.active" ng-if="vm.tab.previewTab.tabVisible" heading="{{'PREVIEW_TAB' | translate}}">
								<div class="panel panel-default">
									<div class="panel-body">
										<!-- formly here -->
										<form ng-submit="vm.onSubmit()">
											<formly-form id="previewFormlyForm" model="vm.dataModel" fields="vm.wfFormFields">
											<span class="pull-right">
												<button class="btn btn-primary" type="submit">{{vm.configuration.submitButtonText}}</button>
												<button class="btn btn-primary" type="cancel">{{vm.configuration.cancelButtonText}}</button>
												</span>
											</formly-form>
										</form>
									</div>
								</div>
								<div ng-if="vm.tab.previewTab.modelsVisible" class="panel panel-default">
									<div class="panel-body">
										<p>{{'DATA_MODEL' | translate}}</p>
										<pre>
											{{vm.dataModel | json}}
										</pre>
									</div>
								</div>
								<div ng-if="vm.tab.previewTab.modelsVisible" class="panel panel-default">
									<div class="panel-body">
										<p>{{'FIELDS_MODEL' | translate}}</p>
										<pre>
											{{vm.wfFormFieldsOnlyNeededProperties | json}}
										</pre>
									</div>
								</div>
							</uib-tab>
						</uib-tabset>
					</div>
				</div>
			</section>
			<hr/>
			<!--<section>
				<h6 class="text-right">Easy form generator : {{vm.easyFormGeneratorVERSION}} — Erwan DATIN (MacKentoch)</h6>
			</section>-->
		</div>
	</div>
</section>
